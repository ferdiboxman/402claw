name: Dispatcher Monitoring

on:
  workflow_dispatch:
  schedule:
    - cron: "*/30 * * * *"

jobs:
  dispatcher-health:
    name: Check Dispatcher Health + Analytics
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: 22

      - name: Run monitor script
        env:
          DISPATCHER_BASE_URL: ${{ vars.DISPATCHER_BASE_URL }}
          MONITOR_TIMEOUT_MS: "8000"
          MONITOR_MAX_HEALTH_LATENCY_MS: "1200"
          MONITOR_MAX_ANALYTICS_LATENCY_MS: "2500"
          CLAWR_EVENTS_API_TOKEN: ${{ secrets.CLAWR_EVENTS_API_TOKEN }}
        run: node ./scripts/monitor-dispatcher.mjs
